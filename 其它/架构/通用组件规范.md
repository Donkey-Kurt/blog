
# 目标

本文档主要描述出，封装通用组件的全过程和一些建议和原则。

# 定义

1. 通用组件：不依赖任何第三方库的组件。本文档中的组件，都指的是通用组件。
2. 通用view组件：不依赖任何第三方库的且含有视图（html和css）的组件。本文档中的view组件，都指的是通用view组件。
3. 通用功能组件：不依赖任何第三方库的不含有视图的组件。本文档中的功能组件，都指的是通用功能组件。
4. 容器标签：view组件要显示的位置，view组件会初始化到此标签中
5. 组件实例对象:每一个view组件在调用过初始化方法后，会实例化出一个组件实例对象，此对象，会被绑定到容器标签上的组件名称属性上。比如，视频组件会被绑定到BFFVideo属性上。
6. 通用组件关键字：BFF（Babytree Front-end Framework）


# 业务使用方式

首先我们从期望的业务中的使用方式，来对组件有个感性的认识。

## 组件引入

组件需要支持三种引入方式，以支持不同技术体系的项目。

#### npm安装

示例：
```
npm i git+ssh://git@192.168.24.32:front-end/native.git
```

注意：目前npm的安装方式，只能安装最新版，不能按版本安装（支持版本需要将组件发布到npm仓库中）

#### url直接引入

示例：
```
<script src="//static02.babytreeimg.com/img/bca/native/0.1.4/native.min.js"></script>
```

#### php方法引入

示例：
```
StaticFileControl::addXXX('/img/bca/native/0.1.4/native.min.js');
```

## 功能组件使用

功能组件就是一组js接口，所以功能组件的资源一般就只有js。

首先，将功能组件js引入到页面。

然后，根据约定的变量或者import到页面的变量，按照文档直接使用即可。

例如：与原生通信组件bbtNative

页面引入:
```
<script src="//static02.babytreeimg.com/img/bca/native/0.1.4/native.min.js"></script>
```

调用登录接口：
```
<script>
bbtNative.login();
</script>
```

## view组件使用

view组件会提供视图，比功能组件的使用会稍微复杂一些，可能会涉及到css等资源。

首先，将view组件js引入到页面中，如果使用url方式引入，可能还需要引入css，具体需要查看组件使用文档。

然后，在html中，定义view组件的显示位置，也就是组件的容器标签位置，比如一个特殊标记的div。

最后，根据约定的变量或者import到页面的变量，执行view组件初始化方法，传入那个刚定义的特殊标记的div，会实例化出来的组件实例对象，并将其写到容器标签上

在想使用组件接口的时候，可以从组件容器div上获得对应的组件实例对象，可以调用组件实例对象对应的接口。

例如：视频组件BFFVideo。

页面引入:
```
<script src="//static02.babytreeimg.com/img/bca/native/0.1.4/BFFvideo.min.js"></script>
```
```
<link href="//static02.babytreeimg.com/img/bca/native/0.1.4/BFFvideo.min.css"></link>
```

html中 标记video组件显示的位置:
```
<div id="i-am-video" ></div>
```

js中 调用video组件初始化接口：
```
<script>
BFFVideo.init({ container: '#i-am-video', url: 'http://xxx/a.video' });
</script>
```

js中 调用组件实例对象的play接口：
```
<script>
document.getElementById(#i-am-video).BFFVideo.play();
</script>
```

# 组件命名规范

命名一个组件，使用首字母大写的驼峰命名方式。

请使用英文，不要使用拼音。

尽量保持简洁。

使用BFF开头。

例如：视频组件，命名为： BFFVideo


# 代码库

使用gitlab管理，每个组件是一个project。

gitlab地址：http://192.168.24.32/groups/front-end

master分支为最新代码分支。

开发需要自行建立开发分支。

发布后将分支合并到master，同时使用版本号打tag，打tag的时候要编写详细的升级和改动说明。

# 发布流程

#### npm发布

将代码合并到master后，再npm安装就可以安装到最新版。

注意：npm的安装方式只能安装到最新版，不能安装到某一版本。（支持版本需要将组件发布到npm仓库中）

#### url发布

将build出来的成果物，js，css，图片等，提交到bbt-common-asset库中。

此种方式，支持版本号，业务代码如果想升级或者降级到某一版本，修改引入的url路径上的版本号即可。

# 版本号规则

使用三位版本号，a.b.c。例如0.1.3。

初始版本建议：1.0.0

如有大的功能升级或调整，需要a+1，b置为0，c置为0。

正常的功能升级b+1，c置为0。

由于bug的修改产生的升级c+1。

# 命名空间约束

命名空间约束主要约束的是可能发生的在同一命名空间下，命名可能会相互污染的问题。

可能产生的命名污染会有以下几种情况：

1. 通过url引入的组件，需要在window空间中设置一个js全局变量，这个变量名当引入多个组件的时候可能会互相污染。
2. view组件初始化产生的组件实例对象，在容器标签上的属性名称，可能会与容器标签上其它的属性名称互相污染
3. view组件的css中使用的class名称，可能会与当前页面使用的其它css文件中的class命名相互污染。

所以，做出如下约束：

#### 组件的全局变量名称

直接使用组件名称。

#### 组件实例对象的属性名称

直接使用组件名称。

#### css的class名称

原则上只允许污染一次命名空间，使用【.组件名称】作为最上层class的名称。

其余class都作为子选择器。

# 功能组件定义

功能组件一般会有两种情况。

## 无状态功能组件

无需保存状态，都是纯方法的组件，功能类似于util。

#### 对外暴露规范：

建议对外暴露如下结构对象：

```
{
	func1: () => {},
	func2: () => {},
}
```

此对象中所有方法，相当于public方法，可以被业务代码使用。

public方法命名要求使用首字母小写的驼峰命名，使用英文而不要使用拼音。

非public的方法，不要写到这个对象中。

不要直接暴露属性，如果需要访问属性请暴露相应get和set方法来操作。

假设业务代码在使用BFFXxxUtil组件的时候,直接使用其方法即可，如下：

```
BFFXxxUtil.func1();
```

#### 接口入参规范

原则上要求接口入参只能有0~1个参数。

如果有1个参数的时候，要求参数类型必须是对象结构{}。例如{url: 'http://a.b.c', title: '标题名称'}

这样可以保持最佳的扩展性和语义性。

#### 事件规范

自定义事件的命名要以on开头并遵循驼峰命名方式，请使用英文，不要使用拼音。

自定义事件的入参，要符合接口入参规范。


## 有状态功能组件

#### 对外暴露规范：

这种情况要使用面向对象的方式设计和编程。

对外暴露的是es6的class。

假设业务在使用BFFVersion的时候，要先实例化对象，然后通过实例化的对象进行后续操作。

public方法命名要求使用首字母小写的驼峰命名，使用英文而不要使用拼音。

非public方法请用_下划线开头定义。

```
const ver789 = new BFFVersion({v: '7.8.9'});
console.log(ver789.equals('7.8.10'));
```

#### 构造器规范

构造器参数要求符合接口入参规范。

必填参数要求必须使用构造器传入。

非必填参数可以使用构造器传入，也可以后边通过接口传入，根据情况灵活设计即可。


#### 接口入参规范

同无状态组件的接口入参规范。

#### 事件规范

同无状态组件的事件规范。

# view组件定义

### view组件定义-js

### view组件定义-css

### view组件定义-html

### view组件生命周期

# 文档要求

# 示例代码要求

# 测试要求






